<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polish Master - Phrasebook Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: white;
            color: #667eea;
            font-weight: 600;
        }
        
        /* Tier Navigation */
        .tier-nav {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .tier-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .tier-tab.foundation { border-color: transparent; }
        .tier-tab.foundation.active { border-color: #9b59b6; background: #f8f5ff; }
        
        .tier-tab.survival { border-color: transparent; }
        .tier-tab.survival.active { border-color: #27ae60; background: #f0fff4; }
        
        .tier-tab.practical { border-color: transparent; }
        .tier-tab.practical.active { border-color: #f39c12; background: #fffbf0; }
        
        .tier-tab.advanced { border-color: transparent; }
        .tier-tab.advanced.active { border-color: #3498db; background: #f0f8ff; }
        
        .tier-tab .tier-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .tier-tab .tier-count {
            font-size: 12px;
            color: #666;
        }
        
        /* Search */
        .search-container {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        /* Quick Access */
        .quick-access {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .quick-btn {
            flex: 1;
            padding: 10px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .quick-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Category Browser */
        .category-browser {
            padding: 20px;
        }
        
        .category-section {
            margin-bottom: 20px;
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .category-header:hover {
            background: #e9ecef;
        }
        
        .category-header.expanded {
            background: #667eea;
            color: white;
        }
        
        .category-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .category-count {
            font-size: 14px;
            color: #666;
        }
        
        .category-header.expanded .category-count {
            color: rgba(255,255,255,0.8);
        }
        
        .category-content {
            display: none;
            padding: 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }
        
        .category-content.show {
            display: block;
        }
        
        /* Phrase Card */
        .phrase-card {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .phrase-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }
        
        .phrase-polish {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .phrase-english {
            font-size: 16px;
            color: #666;
        }
        
        .phrase-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 5px 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .action-btn.favorited {
            background: #ffd700;
            color: #333;
        }
        
        /* Level List */
        .level-list {
            padding: 20px;
        }
        
        .level-card {
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .level-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .level-card.foundation { border-left: 5px solid #9b59b6; }
        .level-card.survival { border-left: 5px solid #27ae60; }
        .level-card.practical { border-left: 5px solid #f39c12; }
        .level-card.advanced { border-left: 5px solid #3498db; }
        
        .level-number {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .level-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .level-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 20px;
            }
            
            .tier-tab {
                font-size: 12px;
                padding: 12px 10px;
            }
            
            .quick-access {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>üáµüá± Polish Master</h1>
            <div class="mode-toggle">
                <button class="mode-btn" onclick="switchMode('learning')">üìö Learning Mode</button>
                <button class="mode-btn active" onclick="switchMode('phrasebook')">üìñ Phrasebook Mode</button>
            </div>
        </div>
        
        <!-- Tier Navigation -->
        <div class="tier-nav">
            <div class="tier-tab foundation active" onclick="switchTier('foundation')">
                <div class="tier-name">üü£ FOUNDATION</div>
                <div class="tier-count">123 items</div>
            </div>
            <div class="tier-tab survival" onclick="switchTier('survival')">
                <div class="tier-name">üü¢ SURVIVAL</div>
                <div class="tier-count">350 phrases</div>
            </div>
            <div class="tier-tab practical" onclick="switchTier('practical')">
                <div class="tier-name">üü° PRACTICAL</div>
                <div class="tier-count">700 phrases</div>
            </div>
            <div class="tier-tab advanced" onclick="switchTier('advanced')">
                <div class="tier-name">üîµ ADVANCED</div>
                <div class="tier-count">625 phrases</div>
            </div>
        </div>
        
        <!-- Search -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search phrases in English or Polish..." onkeyup="searchPhrases()">
                <span class="search-icon">üîç</span>
            </div>
        </div>
        
        <!-- Quick Access -->
        <div class="quick-access">
            <div class="quick-btn" onclick="showFavorites()">
                ‚≠ê Favorites <span id="favCount">(0)</span>
            </div>
            <div class="quick-btn" onclick="showRecent()">
                üïê Recent <span id="recentCount">(0)</span>
            </div>
            <div class="quick-btn" onclick="showAllCategories()">
                üìÇ Browse All
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div id="mainContent">
            <!-- This will be populated by JavaScript -->
        </div>
    </div>
    
    <script>
        // State management
        let currentMode = 'phrasebook';
        let currentTier = 'foundation';
        let allPhrases = [];
        let favorites = JSON.parse(localStorage.getItem('polishMasterFavorites') || '[]');
        let recentPhrases = JSON.parse(localStorage.getItem('polishMasterRecent') || '[]');
        
        // Load phrases from all levels
        async function loadAllPhrases() {
            const levels = [0, 0.1, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];
            
            for (const level of levels) {
                try {
                    const response = await fetch(`phrases_${level}.json`);
                    const data = await response.json();
                    const phrases = data.phrases || [];
                    phrases.forEach(p => {
                        p.sourceLevel = level;
                        p.tier = data.tier || 'N/A';
                        p.levelDesc = data.description || '';
                    });
                    allPhrases.push(...phrases);
                } catch (e) {
                    console.log(`Level ${level} not found or error loading`);
                }
            }
            
            console.log(`Loaded ${allPhrases.length} phrases`);
            updateCounts();
            showLevelBrowser();
        }
        
        // Switch mode
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'learning') {
                alert('Learning mode would show flashcard interface');
            } else {
                showLevelBrowser();
            }
        }
        
        // Switch tier
        function switchTier(tier) {
            currentTier = tier;
            document.querySelectorAll('.tier-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tier-tab.${tier}`).classList.add('active');
            showLevelBrowser();
        }
        
        // Show level browser for current tier
        function showLevelBrowser() {
            const tierLevels = {
                'foundation': [0, 0.1],
                'survival': [1, 2, 3, 4, 5],
                'practical': [6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                'advanced': [16, 17, 18, 19, 20, 21, 22]
            };
            
            const levels = tierLevels[currentTier] || [];
            const tierClass = currentTier;
            
            let html = '<div class="level-list">';
            
            levels.forEach(levelNum => {
                const levelPhrases = allPhrases.filter(p => p.sourceLevel === levelNum);
                if (levelPhrases.length > 0) {
                    const levelDesc = levelPhrases[0].levelDesc || 'Unknown';
                    const categories = [...new Set(levelPhrases.map(p => p.category))].filter(Boolean);
                    
                    html += `
                        <div class="level-card ${tierClass}" onclick="showLevel(${levelNum})">
                            <div class="level-number">Level ${levelNum}</div>
                            <div class="level-title">${levelDesc}</div>
                            <div class="level-meta">
                                <span>üìù ${levelPhrases.length} phrases</span>
                                <span>üìÇ ${categories.length} categories</span>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Show specific level with categories
        function showLevel(levelNum) {
            const levelPhrases = allPhrases.filter(p => p.sourceLevel === levelNum);
            const levelDesc = levelPhrases[0]?.levelDesc || 'Unknown';
            
            // Group by category
            const byCategory = {};
            levelPhrases.forEach(phrase => {
                const cat = phrase.category || 'Uncategorized';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(phrase);
            });
            
            let html = '<div class="category-browser">';
            html += `<div style="padding: 20px; border-bottom: 2px solid #e0e0e0;">
                <button onclick="showLevelBrowser()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">‚Üê Back to Levels</button>
                <h2 style="margin-top: 15px;">Level ${levelNum}: ${levelDesc}</h2>
                <p style="color: #666; margin-top: 5px;">${levelPhrases.length} phrases in ${Object.keys(byCategory).length} categories</p>
            </div>`;
            
            Object.keys(byCategory).sort().forEach(category => {
                const phrases = byCategory[category];
                html += `
                    <div class="category-section">
                        <div class="category-header" onclick="toggleCategory(this)">
                            <span class="category-name">üìÇ ${category}</span>
                            <span class="category-count">${phrases.length} phrases</span>
                        </div>
                        <div class="category-content">
                            ${phrases.map(p => renderPhraseCard(p)).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Render phrase card
        function renderPhraseCard(phrase) {
            const isFavorited = favorites.includes(phrase.id);
            const favClass = isFavorited ? 'favorited' : '';
            
            return `
                <div class="phrase-card">
                    <div class="phrase-polish">${phrase.pl}</div>
                    <div class="phrase-english">${phrase.en}</div>
                    <div class="phrase-actions">
                        <button class="action-btn ${favClass}" onclick="toggleFavorite('${phrase.id}', event)">
                            ${isFavorited ? '‚≠ê Favorited' : '‚òÜ Favorite'}
                        </button>
                        <button class="action-btn" onclick="playAudio('${phrase.pl}')">üîä Listen</button>
                        <button class="action-btn" onclick="addToRecent('${phrase.id}')">üìù Practice</button>
                    </div>
                </div>
            `;
        }
        
        // Toggle category expansion
        function toggleCategory(header) {
            header.classList.toggle('expanded');
            const content = header.nextElementSibling;
            content.classList.toggle('show');
        }
        
        // Toggle favorite
        function toggleFavorite(phraseId, event) {
            event.stopPropagation();
            const index = favorites.indexOf(phraseId);
            
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(phraseId);
            }
            
            localStorage.setItem('polishMasterFavorites', JSON.stringify(favorites));
            updateCounts();
            
            // Reload current view
            const levelNum = allPhrases.find(p => p.id === phraseId)?.sourceLevel;
            if (levelNum !== undefined) {
                showLevel(levelNum);
            }
        }
        
        // Add to recent
        function addToRecent(phraseId) {
            // Remove if already exists
            recentPhrases = recentPhrases.filter(id => id !== phraseId);
            // Add to front
            recentPhrases.unshift(phraseId);
            // Keep only last 20
            recentPhrases = recentPhrases.slice(0, 20);
            
            localStorage.setItem('polishMasterRecent', JSON.stringify(recentPhrases));
            updateCounts();
        }
        
        // Show favorites
        function showFavorites() {
            const favPhrases = allPhrases.filter(p => favorites.includes(p.id));
            
            if (favPhrases.length === 0) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚≠ê</div>
                        <h3>No Favorites Yet</h3>
                        <p>Click the ‚òÜ button on any phrase to save it here</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="category-browser">';
            html += `<div style="padding: 20px; border-bottom: 2px solid #e0e0e0;">
                <button onclick="showLevelBrowser()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">‚Üê Back</button>
                <h2 style="margin-top: 15px;">‚≠ê Your Favorites</h2>
                <p style="color: #666; margin-top: 5px;">${favPhrases.length} saved phrases</p>
            </div>`;
            
            html += '<div style="padding: 20px;">';
            favPhrases.forEach(p => {
                html += renderPhraseCard(p);
            });
            html += '</div></div>';
            
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Show recent
        function showRecent() {
            const recentPhrasesData = recentPhrases
                .map(id => allPhrases.find(p => p.id === id))
                .filter(Boolean);
            
            if (recentPhrasesData.length === 0) {
                document.getElementById('mainContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üïê</div>
                        <h3>No Recent Phrases</h3>
                        <p>Practice any phrase to see it here</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="category-browser">';
            html += `<div style="padding: 20px; border-bottom: 2px solid #e0e0e0;">
                <button onclick="showLevelBrowser()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">‚Üê Back</button>
                <h2 style="margin-top: 15px;">üïê Recent Phrases</h2>
                <p style="color: #666; margin-top: 5px;">Last ${recentPhrasesData.length} practiced</p>
            </div>`;
            
            html += '<div style="padding: 20px;">';
            recentPhrasesData.forEach(p => {
                html += renderPhraseCard(p);
            });
            html += '</div></div>';
            
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Show all categories across all levels
        function showAllCategories() {
            const byCategory = {};
            allPhrases.forEach(phrase => {
                const cat = phrase.category || 'Uncategorized';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(phrase);
            });
            
            let html = '<div class="category-browser">';
            html += `<div style="padding: 20px; border-bottom: 2px solid #e0e0e0;">
                <button onclick="showLevelBrowser()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">‚Üê Back</button>
                <h2 style="margin-top: 15px;">üìÇ Browse All Categories</h2>
                <p style="color: #666; margin-top: 5px;">${Object.keys(byCategory).length} categories across all levels</p>
            </div>`;
            
            Object.keys(byCategory).sort().forEach(category => {
                const phrases = byCategory[category];
                html += `
                    <div class="category-section">
                        <div class="category-header" onclick="toggleCategory(this)">
                            <span class="category-name">üìÇ ${category}</span>
                            <span class="category-count">${phrases.length} phrases</span>
                        </div>
                        <div class="category-content">
                            ${phrases.map(p => renderPhraseCard(p)).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Search functionality
        function searchPhrases() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (query.length < 2) {
                showLevelBrowser();
                return;
            }
            
            const results = allPhrases.filter(p => 
                (p.pl && p.pl.toLowerCase().includes(query)) ||
                (p.en && p.en.toLowerCase().includes(query))
            );
            
            let html = '<div class="category-browser">';
            html += `<div style="padding: 20px; border-bottom: 2px solid #e0e0e0;">
                <h2>üîç Search Results</h2>
                <p style="color: #666; margin-top: 5px;">Found ${results.length} phrases matching "${query}"</p>
            </div>`;
            
            if (results.length === 0) {
                html += `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>No Results Found</h3>
                        <p>Try a different search term</p>
                    </div>
                `;
            } else {
                html += '<div style="padding: 20px;">';
                results.forEach(p => {
                    html += renderPhraseCard(p);
                });
                html += '</div>';
            }
            
            html += '</div>';
            document.getElementById('mainContent').innerHTML = html;
        }
        
        // Update counts
        function updateCounts() {
            document.getElementById('favCount').textContent = `(${favorites.length})`;
            document.getElementById('recentCount').textContent = `(${recentPhrases.length})`;
        }
        
        // Play audio (placeholder)
        function playAudio(text) {
            // In real implementation, use Web Speech API or audio files
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pl-PL';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                alert('Audio playback not supported in this browser');
            }
        }
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadAllPhrases();
        });
    </script>
</body>
</html>
